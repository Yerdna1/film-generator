generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                       String                @id @default(cuid())
  name                     String?
  email                    String?               @unique
  emailVerified            DateTime?
  image                    String?
  password                 String?
  role                     String                @default("user")
  costMultiplier           Float                 @default(1.5)
  createdAt                DateTime              @default(now())
  updatedAt                DateTime              @updatedAt
  isBlocked                Boolean               @default(false)
  isApproved               Boolean               @default(false)
  resetToken               String?               @unique
  resetTokenExpires        DateTime?
  accounts                 Account[]
  apiKeys                  ApiKeys?
  credits                  Credits?
  deletionRequests         DeletionRequest[]     @relation("DeletionRequests")
  deletionReviews          DeletionRequest[]     @relation("DeletionReviews")
  notifications            Notification[]
  projects                 Project[]
  invitationsSent          ProjectInvitation[]   @relation("InvitationsSent")
  projectMemberships       ProjectMember[]
  promptEditRequests       PromptEditRequest[]   @relation("PromptEditRequests")
  promptEditReviews        PromptEditRequest[]   @relation("PromptEditReviews")
  regenerationFinalReviews RegenerationRequest[] @relation("RegenerationFinalReviews")
  regenerationRequests     RegenerationRequest[] @relation("RegenerationRequests")
  regenerationReviews      RegenerationRequest[] @relation("RegenerationReviews")
  sessions                 Session[]
  subscription             Subscription?
  userConstants            UserConstants?
}

model Subscription {
  id                  String    @id @default(cuid())
  userId              String    @unique
  polarCustomerId     String?   @unique
  polarSubscriptionId String?   @unique
  status              String    @default("free")
  plan                String    @default("free")
  currentPeriodEnd    DateTime?
  cancelAtPeriodEnd   Boolean   @default(false)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Credits {
  id            String              @id @default(cuid())
  userId        String              @unique
  balance       Int                 @default(0)
  totalSpent    Int                 @default(0)
  totalEarned   Int                 @default(0)
  totalRealCost Float               @default(0)
  lastUpdated   DateTime            @default(now())
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  transactions  CreditTransaction[]
  user          User                @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CreditTransaction {
  id          String   @id @default(cuid())
  creditsId   String
  amount      Int
  realCost    Float    @default(0)
  type        String
  provider    String?
  description String?
  projectId   String?
  metadata    Json?
  createdAt   DateTime @default(now())
  credits     Credits  @relation(fields: [creditsId], references: [id], onDelete: Cascade)

  @@index([creditsId])
  @@index([projectId])
  @@index([type])
  @@index([provider])
  @@index([creditsId, type])
  @@index([creditsId, type, projectId])
  @@index([creditsId, createdAt])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model ApiKeys {
  id                     String   @id @default(cuid())
  userId                 String   @unique
  geminiApiKey           String?
  grokApiKey             String?
  kieApiKey              String?
  elevenLabsApiKey       String?
  claudeApiKey           String?
  openaiApiKey           String?
  nanoBananaApiKey       String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  sunoApiKey             String?
  llmProvider            String   @default("kie")
  openRouterApiKey       String?
  musicProvider          String   @default("kie")
  piapiApiKey            String?
  openRouterModel        String   @default("anthropic/claude-4.5-sonnet")
  imageProvider          String   @default("kie")
  modalImageEndpoint     String?
  modalLlmEndpoint       String?
  modalMusicEndpoint     String?
  modalTtsEndpoint       String?
  modalVideoEndpoint     String?
  ttsProvider            String   @default("kie")
  videoProvider          String   @default("kie")
  modalImageEditEndpoint String?
  resendApiKey           String?
  modalVectcutEndpoint   String?
  kieImageModel          String?  @default("nano-banana-pro-2k")
  kieMusicModel          String?  @default("suno/v3-5-music")
  kieTtsModel            String?  @default("elevenlabs/text-to-dialogue-v3")
  kieVideoModel          String?  @default("grok-imagine/image-to-video")
  preferOwnKeys          Boolean  @default(false)
  kieLlmModel            String?  @default("claude/claude-sonnet-4-20250514")
  user                   User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model OrganizationApiKeys {
  id                     String   @id @default(cuid())
  geminiApiKey           String?
  grokApiKey             String?
  kieApiKey              String?
  elevenLabsApiKey       String?
  claudeApiKey           String?
  openaiApiKey           String?
  nanoBananaApiKey       String?
  sunoApiKey             String?
  openRouterApiKey       String?
  piapiApiKey            String?
  openRouterModel        String   @default("anthropic/claude-4.5-sonnet")
  kieImageModel          String?  @default("nano-banana-pro-2k")
  kieVideoModel          String?  @default("grok-imagine/image-to-video")
  kieTtsModel            String?  @default("elevenlabs/text-to-dialogue-v3")
  kieMusicModel          String?  @default("suno/v3-5-music")
  modalLlmEndpoint       String?
  modalTtsEndpoint       String?
  modalImageEndpoint     String?
  modalImageEditEndpoint String?
  modalVideoEndpoint     String?
  modalMusicEndpoint     String?
  modalVectcutEndpoint   String?
  lastUpdatedBy          String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  kieLlmModel            String?  @default("claude/claude-sonnet-4-20250514")
}

model Project {
  id                   String                @id @default(cuid())
  name                 String
  userId               String
  style                String                @default("disney-pixar")
  masterPrompt         String?
  currentStep          Int                   @default(1)
  isComplete           Boolean               @default(false)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  settings             Json                  @default("{\"resolution\": \"hd\", \"sceneCount\": 12, \"storyModel\": \"claude-sonnet-4.5\", \"aspectRatio\": \"16:9\", \"voiceLanguage\": \"sk\", \"voiceProvider\": \"gemini-tts\", \"characterCount\": 2, \"imageResolution\": \"2k\"}")
  story                Json                  @default("{\"tone\": \"heartfelt\", \"genre\": \"adventure\", \"title\": \"\", \"concept\": \"\", \"setting\": \"\"}")
  voiceSettings        Json                  @default("{\"language\": \"sk\", \"provider\": \"gemini-tts\", \"characterVoices\": {}}")
  visibility           String                @default("private")
  renderedDraftUrl     String?
  renderedVideoUrl     String?
  characters           Character[]
  deletionRequests     DeletionRequest[]
  user                 User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  invitations          ProjectInvitation[]
  members              ProjectMember[]
  promptEditRequests   PromptEditRequest[]
  regenerationRequests RegenerationRequest[]
  scenes               Scene[]

  @@index([userId])
  @@index([visibility])
  @@index([userId, updatedAt])
  @@index([visibility, updatedAt])
}

model Character {
  id                String   @id @default(cuid())
  projectId         String
  name              String
  description       String
  visualDescription String
  personality       String?
  masterPrompt      String
  imageUrl          String?
  voiceId           String?
  voiceName         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  project           Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model Scene {
  id                        String    @id @default(cuid())
  projectId                 String
  number                    Int
  title                     String
  description               String
  textToImagePrompt         String
  imageToVideoPrompt        String
  cameraShot                String    @default("medium")
  imageUrl                  String?
  videoUrl                  String?
  audioUrl                  String?
  duration                  Int       @default(6)
  dialogue                  Json      @default("[]")
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt
  imageUpdatedAt            DateTime?
  locked                    Boolean   @default(false)
  videoGeneratedFromImageAt DateTime?
  useTtsInVideo             Boolean   @default(true)
  project                   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectId, number])
}

model ActionCost {
  id          String    @id @default(cuid())
  actionType  String
  provider    String
  cost        Float
  description String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  validFrom   DateTime  @default(now())
  validTo     DateTime?
  length      String?
  modality    String?
  model       String?
  quality     String?

  @@unique([actionType, provider, model, modality, quality, length])
  @@index([actionType])
  @@index([provider])
  @@index([validFrom])
}

model ImageGenerationJob {
  id              String    @id @default(cuid())
  projectId       String
  userId          String
  status          String    @default("pending")
  totalScenes     Int
  completedScenes Int       @default(0)
  failedScenes    Int       @default(0)
  progress        Int       @default(0)
  errorDetails    String?
  createdAt       DateTime  @default(now())
  startedAt       DateTime?
  completedAt     DateTime?
  imageModel      String?
  imageProvider   String?

  @@index([projectId])
  @@index([userId])
  @@index([status])
}

model SceneGenerationJob {
  id              String    @id @default(cuid())
  projectId       String
  userId          String
  status          String    @default("pending")
  totalScenes     Int
  completedScenes Int       @default(0)
  progress        Int       @default(0)
  errorDetails    String?
  createdAt       DateTime  @default(now())
  startedAt       DateTime?
  completedAt     DateTime?
  llmModel        String?
  llmProvider     String?

  @@index([projectId])
  @@index([userId])
  @@index([status])
}

model VideoGenerationJob {
  id              String    @id @default(cuid())
  projectId       String
  userId          String
  status          String    @default("pending")
  totalVideos     Int
  completedVideos Int       @default(0)
  failedVideos    Int       @default(0)
  progress        Int       @default(0)
  errorDetails    String?
  videoProvider   String?
  videoModel      String?
  createdAt       DateTime  @default(now())
  startedAt       DateTime?
  completedAt     DateTime?

  @@index([projectId])
  @@index([userId])
  @@index([status])
}

model PromptGenerationJob {
  id              String    @id @default(cuid())
  projectId       String
  userId          String
  status          String    @default("pending")
  progress        Int       @default(0)
  errorDetails    String?
  llmProvider     String?
  llmModel        String?
  createdAt       DateTime  @default(now())
  startedAt       DateTime?
  completedAt     DateTime?

  @@index([projectId])
  @@index([userId])
  @@index([status])
}

model VoiceoverGenerationJob {
  id                  String    @id @default(cuid())
  projectId           String
  userId              String
  status              String    @default("pending")
  totalAudioLines     Int
  completedAudioLines Int       @default(0)
  failedAudioLines    Int       @default(0)
  progress            Int       @default(0)
  errorDetails        String?
  audioProvider       String?
  audioModel          String?
  createdAt           DateTime  @default(now())
  startedAt           DateTime?
  completedAt         DateTime?

  @@index([projectId])
  @@index([userId])
  @@index([status])
}

model MusicGenerationJob {
  id              String    @id @default(cuid())
  projectId       String
  userId          String
  status          String    @default("pending")
  progress        Int       @default(0)
  errorDetails    String?
  musicProvider   String?
  musicModel      String?
  prompt          String?
  instrumental    Boolean?
  audioUrl        String?
  title           String?
  createdAt       DateTime  @default(now())
  startedAt       DateTime?
  completedAt     DateTime?

  @@index([projectId])
  @@index([userId])
  @@index([status])
}

model VideoCompositionJob {
  id              String    @id @default(cuid())
  projectId       String
  userId          String
  status          String    @default("pending")
  progress        Int       @default(0)
  phase           String?
  outputFormat    String    @default("both")
  resolution      String    @default("hd")
  includeMusic    Boolean   @default(false)
  includeCaptions Boolean   @default(false)
  videoUrl        String?
  draftUrl        String?
  srtUrl          String?
  errorMessage    String?
  creditsCost     Int       @default(0)
  realCost        Float     @default(0)
  duration        Float     @default(0)
  fileSize        Int       @default(0)
  createdAt       DateTime  @default(now())
  startedAt       DateTime?
  completedAt     DateTime?

  @@index([projectId])
  @@index([userId])
  @@index([status])
}

model ProjectMember {
  id        String   @id @default(cuid())
  projectId String
  userId    String
  role      String   @default("reader")
  joinedAt  DateTime @default(now())
  invitedBy String?
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@index([projectId])
  @@index([userId])
}

model ProjectInvitation {
  id         String    @id @default(cuid())
  projectId  String
  email      String
  role       String    @default("reader")
  token      String    @unique @default(cuid())
  invitedBy  String
  expiresAt  DateTime
  acceptedAt DateTime?
  status     String    @default("pending")
  createdAt  DateTime  @default(now())
  inviter    User      @relation("InvitationsSent", fields: [invitedBy], references: [id])
  project    Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([email])
  @@index([token])
  @@index([status])
}

model DeletionRequest {
  id          String    @id @default(cuid())
  projectId   String
  requesterId String
  targetType  String
  targetId    String
  targetName  String?
  reason      String?
  status      String    @default("pending")
  reviewedBy  String?
  reviewedAt  DateTime?
  reviewNote  String?
  createdAt   DateTime  @default(now())
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  requester   User      @relation("DeletionRequests", fields: [requesterId], references: [id])
  reviewer    User?     @relation("DeletionReviews", fields: [reviewedBy], references: [id])

  @@index([projectId])
  @@index([requesterId])
  @@index([status])
}

model RegenerationRequest {
  id              String    @id @default(cuid())
  projectId       String
  requesterId     String
  targetType      String
  targetId        String
  targetName      String?
  reason          String?
  status          String    @default("pending")
  reviewedBy      String?
  reviewedAt      DateTime?
  reviewNote      String?
  completedAt     DateTime?
  errorMessage    String?
  createdAt       DateTime  @default(now())
  attemptsUsed    Int       @default(0)
  maxAttempts     Int       @default(3)
  finalReviewAt   DateTime?
  finalReviewBy   String?
  finalReviewNote String?
  generatedUrls   Json?
  selectedUrl     String?
  creditsPaid     Int       @default(0)
  logs            Json?
  batchId         String?
  finalReviewer   User?     @relation("RegenerationFinalReviews", fields: [finalReviewBy], references: [id])
  project         Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  requester       User      @relation("RegenerationRequests", fields: [requesterId], references: [id])
  reviewer        User?     @relation("RegenerationReviews", fields: [reviewedBy], references: [id])

  @@index([projectId])
  @@index([requesterId])
  @@index([status])
  @@index([targetId])
  @@index([batchId])
}

model PromptEditRequest {
  id          String    @id @default(cuid())
  projectId   String
  requesterId String
  sceneId     String
  sceneName   String?
  fieldName   String
  oldValue    String
  newValue    String
  status      String    @default("pending")
  reviewedBy  String?
  reviewedAt  DateTime?
  reviewNote  String?
  createdAt   DateTime  @default(now())
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  requester   User      @relation("PromptEditRequests", fields: [requesterId], references: [id])
  reviewer    User?     @relation("PromptEditReviews", fields: [reviewedBy], references: [id])

  @@index([projectId])
  @@index([requesterId])
  @@index([sceneId])
  @@index([status])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String
  title     String
  message   String
  metadata  Json?
  read      Boolean  @default(false)
  actionUrl String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([createdAt])
  @@index([userId, read])
  @@index([userId, createdAt])
  @@index([userId, read, createdAt])
}

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
}

model AppConfig {
  id              String   @id @default("app-config")
  startingCredits Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model UserConstants {
  id                     String   @id @default(cuid())
  userId                 String   @unique
  characterAspectRatio   String   @default("1:1")
  sceneImageResolution   String   @default("2k")
  sceneAspectRatio       String   @default("16:9")
  videoResolution        String   @default("hd")
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  characterImageProvider String   @default("gemini")
  sceneImageProvider     String   @default("gemini")
  user                   User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model KieImageModel {
  id                    String   @id @default(cuid())
  modelId               String   @unique
  name                  String
  provider              String
  baseModel             String?
  description           String?
  modality              String[]
  credits               Int
  cost                  Float
  qualityOptions        String[]
  speedVariants         String[]
  maxPromptLength       Int?
  maxImages             Int?
  supportedAspectRatios String[]
  inputParameters       Json
  outputParameters      Json
  constraints           Json?
  keyFeatures           String[]
  useCases              String[]
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  apiModelId            String?
  defaultResolution     String?  @default("2k")

  @@map("kie_image_models")
}

model KieVideoModel {
  id                            String   @id @default(cuid())
  modelId                       String   @unique
  name                          String
  provider                      String
  description                   String?
  modality                      String[]
  quality                       String?
  length                        String?
  credits                       Int
  cost                          Float
  supportedResolutions          String[]
  supportedDurations            String[]
  supportedAspectRatios         String[]
  defaultResolution             String
  defaultDuration               String
  defaultAspectRatio            String
  pricing                       Json
  resolutionDurationConstraints Json?
  inputParameters               Json?
  outputParameters              Json?
  keyFeatures                   String[]
  constraints                   Json?
  isActive                      Boolean  @default(true)
  createdAt                     DateTime @default(now())
  updatedAt                     DateTime @updatedAt
  apiModelId                    String?

  @@map("kie_video_models")
}

model KieTtsModel {
  id                  String   @id @default(cuid())
  modelId             String   @unique
  name                String
  provider            String
  description         String?
  credits             Int
  cost                Float
  costUnit            String?
  supportedLanguages  Int
  languageList        String[]
  voiceOptions        String[]
  audioQualityOptions Json
  maxTextLength       Int?
  specialFeatures     String[]
  inputParameters     Json
  outputParameters    Json?
  isActive            Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  modality            String[]
  apiModelId          String?

  @@map("kie_tts_models")
}

model KieMusicModel {
  id               String   @id @default(cuid())
  modelId          String   @unique
  name             String
  provider         String
  description      String?
  credits          Int
  cost             Float
  modality         String[]
  durationOptions  String[]
  genreSupport     String[]
  inputParameters  Json?
  outputParameters Json?
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  apiModelId       String?

  @@map("kie_music_models")
}

model KieLlmModel {
  id                 String   @id @default(cuid())
  modelId            String   @unique
  name               String
  provider           String
  description        String?
  creditsPerToken    Float?
  creditsPerRequest  Int?
  cost               Float
  contextWindow      Int?
  maxOutputTokens    Int?
  supportedLanguages String[]
  inputParameters    Json?
  outputParameters   Json?
  capabilities       String[]
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  modality           String[]
  apiModelId         String?

  @@map("kie_llm_models")
}

model Provider {
  id                  String       @id @default(cuid())
  providerId          String       @unique
  name                String
  displayName         String
  icon                String
  color               String
  description         String?
  isActive            Boolean      @default(true)
  isDefault           Boolean      @default(false)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  apiKeyField         String
  modelField          String?
  supportedModalities String[]
  requiresEndpoint    Boolean      @default(false)
  helpLink            String?
  setupGuide          String?
  imageModels         ImageModel[]
  llmModels           LlmModel[]
  musicModels         MusicModel[]
  ttsModels           TtsModel[]
  videoModels         VideoModel[]

  @@index([isActive])
  @@index([providerId])
}

model ImageModel {
  id                    String   @id @default(cuid())
  providerId            String
  modelId               String   @unique
  name                  String
  displayName           String
  description           String?
  apiModelId            String
  modality              String[] @default(["image"])
  qualityOptions        String[]
  maxPromptLength       Int?
  maxImages             Int?     @default(1)
  supportedAspectRatios String[]
  supportedResolutions  String[]
  credits               Int      @default(27)
  cost                  Float
  costUnit              String   @default("per_image")
  inputParameters       Json
  outputParameters      Json
  defaultParameters     Json?
  constraints           Json?
  keyFeatures           String[]
  useCases              String[]
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  provider              Provider @relation(fields: [providerId], references: [providerId])

  @@index([providerId])
  @@index([isActive])
  @@index([modelId])
}

model VideoModel {
  id                    String   @id @default(cuid())
  providerId            String
  modelId               String   @unique
  name                  String
  displayName           String
  description           String?
  apiModelId            String
  modality              String[] @default(["video"])
  supportedResolutions  String[]
  supportedDurations    String[]
  supportedAspectRatios String[]
  defaultResolution     String
  defaultDuration       String
  defaultAspectRatio    String
  maxDuration           Int?
  credits               Int      @default(20)
  cost                  Float
  costUnit              String   @default("per_second")
  pricing               Json
  inputParameters       Json
  outputParameters      Json
  defaultParameters     Json?
  constraints           Json?
  keyFeatures           String[]
  isAsync               Boolean  @default(true)
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  provider              Provider @relation(fields: [providerId], references: [providerId])

  @@index([providerId])
  @@index([isActive])
  @@index([modelId])
}

model TtsModel {
  id                  String   @id @default(cuid())
  providerId          String
  modelId             String   @unique
  name                String
  displayName         String
  description         String?
  apiModelId          String
  modality            String[] @default(["audio", "speech"])
  supportedLanguages  String[]
  voiceOptions        Json
  audioQualityOptions String[]
  maxTextLength       Int?
  credits             Int      @default(6)
  cost                Float
  costUnit            String   @default("per_character")
  inputParameters     Json
  outputParameters    Json
  defaultParameters   Json?
  specialFeatures     String[]
  isActive            Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  provider            Provider @relation(fields: [providerId], references: [providerId])

  @@index([providerId])
  @@index([isActive])
  @@index([modelId])
}

model MusicModel {
  id                String   @id @default(cuid())
  providerId        String
  modelId           String   @unique
  name              String
  displayName       String
  description       String?
  apiModelId        String
  modality          String[] @default(["audio", "music"])
  durationOptions   String[]
  genreSupport      String[]
  instrumentSupport String[]
  maxDuration       Int?
  credits           Int      @default(10)
  cost              Float
  costUnit          String   @default("per_generation")
  inputParameters   Json
  outputParameters  Json
  defaultParameters Json?
  isAsync           Boolean  @default(true)
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  provider          Provider @relation(fields: [providerId], references: [providerId])

  @@index([providerId])
  @@index([isActive])
  @@index([modelId])
}

model LlmModel {
  id                 String   @id @default(cuid())
  providerId         String
  modelId            String   @unique
  name               String
  displayName        String
  description        String?
  apiModelId         String
  modality           String[] @default(["text"])
  contextWindow      Int?
  maxOutputTokens    Int?
  supportedLanguages String[]
  capabilities       String[]
  creditsPerToken    Float?
  creditsPerRequest  Int?
  cost               Float
  costUnit           String   @default("per_1k_tokens")
  inputParameters    Json
  outputParameters   Json
  defaultParameters  Json?
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  provider           Provider @relation(fields: [providerId], references: [providerId])

  @@index([providerId])
  @@index([isActive])
  @@index([modelId])
}

model PageVisibility {
  id                   String   @id @default(cuid())
  path                 String   @unique
  name                 String
  description          String?
  allowedRoles         Json     // "*" for all roles, or array like ["admin", "premium"]
  allowedSubscriptionStatus Json? // null for all, or array like ["premium", "trial"]
  hideIfUserOwnsApiKey  Boolean  @default(false) // Hide page if user has their own API keys configured
  isEnabled            Boolean  @default(true) // Master switch to enable/disable this visibility rule
  priority             Int      @default(0) // Higher priority rules are checked first
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([path])
  @@index([isEnabled])
  @@index([priority])
}
